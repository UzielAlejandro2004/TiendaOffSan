const productos = [
  {nombre:"Vestido Elegante", categoria:"Ropa Mujer", precio:"$699", img:"https://images.unsplash.com/photo-1503342217505-b0a15ec3261c?auto=format&fit=crop&w=200&q=80"},
  {nombre:"Blusa de Moda", categoria:"Ropa Mujer", precio:"$349", img:"https://images.unsplash.com/photo-1521334884684-d80222895322?auto=format&fit=crop&w=200&q=80"},
  {nombre:"Jeans Casual", categoria:"Ropa Mujer", precio:"$550", img:"https://images.unsplash.com/photo-1520975922807-9f22369b4bab?auto=format&fit=crop&w=200&q=80"},
  {nombre:"SuÃ©ter de Lana", categoria:"Ropa Mujer", precio:"$450", img:"https://images.unsplash.com/photo-1523413651479-597eb2da0ad6?auto=format&fit=crop&w=200&q=80"},
  {nombre:"Camisa Casual", categoria:"Ropa Hombre", precio:"$430", img:"https://images.unsplash.com/photo-1541099649105-f69ad21f3246?auto=format&fit=crop&w=200&q=80"},
  {nombre:"Chaqueta de Cuero", categoria:"Ropa Hombre", precio:"$1150", img:"https://images.unsplash.com/photo-1541099649105-f69ad21f3246?auto=format&fit=crop&w=200&q=80"},
  {nombre:"Jeans Azul", categoria:"Ropa Hombre", precio:"$590", img:"https://images.unsplash.com/photo-1600180758890-c731741c73fd?auto=format&fit=crop&w=200&q=80"},
  {nombre:"Pulsera", categoria:"Accesorios Variados", precio:"$120", img:"https://images.unsplash.com/photo-1503354200673-3f52d6be49bb?auto=format&fit=crop&w=200&q=80"}
];
let carrito=[], estado = "inicio";

const messages = document.getElementById("messages");

function printBot(html){
    messages.innerHTML += `<div class="bot">${html}</div>`;
    messages.scrollTop = messages.scrollHeight;
}
function printUser(html){
    messages.innerHTML += `<div class="user"><b>TÃº:</b> ${html}</div>`;
    messages.scrollTop = messages.scrollHeight;
}

function showQuickMenu(){
    printBot("Â¿Sobre quÃ© tema necesitas ayuda?<br>" +
        `<button class="option-btn" onclick="themeOption('productos')">Productos</button>` +
        `<button class="option-btn" onclick="themeOption('populares')">Lo mÃ¡s popular</button>` +
        `<button class="option-btn" onclick="themeOption('pagos')">Pagos</button>` +
        `<button class="option-btn" onclick="themeOption('envÃ­o')">EnvÃ­os</button>` +
        `<button class="option-btn" onclick="themeOption('contacto')">Contacto humano</button>` +
        `<button class="option-btn" onclick="themeOption('queja')">Quejas</button>` +
        `<button class="option-btn" onclick="themeOption('ayuda')">GuÃ­a de compra</button>`);
}

window.onload = ()=>{ mensajeBienvenida(); };
function mensajeBienvenida(){
    estado = "inicio";
    messages.innerHTML = "";
    printBot("Â¡Hola! ðŸ‘‹ Soy tu asistente virtual.<br>Puedo ayudarte a conocer productos, pagos, envÃ­os, poner queja o conectar con un asesor. Â¿QuÃ© te gustarÃ­a hacer hoy?");
    showQuickMenu();
}
document.getElementById("send").onclick = userMessage;
document.getElementById("input").addEventListener("keydown", (e)=>{ if(e.key==="Enter") userMessage(); });

function userMessage(){
    let msg = document.getElementById("input").value.trim();
    if(!msg) return;
    printUser(msg);
    botReply(msg);
    document.getElementById("input").value = "";
}

function themeOption(op){
    if(op==='productos'){
        estado = "categoria";
        printUser("Quiero informaciÃ³n sobre productos");
        printBot(`Â¿De quÃ© categorÃ­a buscas?<br>
            <button class="option-btn" onclick="categoryProducts('Ropa Mujer')">Ropa Mujer</button>
            <button class="option-btn" onclick="categoryProducts('Ropa Hombre')">Ropa Hombre</button>
            <button class="option-btn" onclick="categoryProducts('Accesorios Variados')">Accesorios</button>
            <button class="option-btn" onclick="mensajeBienvenida()">MenÃº principal</button>`);
    } else if(op==='populares'){
        printUser("MuÃ©strame lo mÃ¡s popular");
        productos.slice(0,4).forEach(p=>{
            printBot(`<div class="producto-tarjeta">
                        <img src="${p.img}" alt="${p.nombre}">
                        <div><b>${p.nombre}</b><br>Precio: ${p.precio}<br><small>${p.categoria}</small></div></div>
                        <button class="option-btn" onclick="productDetails('${p.nombre}')">Quiero este</button>`);
        });
        printBot(`<button class="option-btn" onclick="mensajeBienvenida()">Volver al menÃº</button>`);
    } else if(op==='pagos'){
        printUser("Formas de pago disponibles");
        printBot("Aceptamos tarjetas, PayPal, transferencia bancaria, OXXO, Apple Pay y Google Pay.<br><button class='option-btn' onclick='mensajeBienvenida()'>MenÃº principal</button>");
    } else if(op==='envÃ­o'){
        printUser("Opciones de envÃ­o");
        printBot("EnvÃ­o estÃ¡ndar, express, internacional y recojo en tienda. Todos con rastreo.<br><button class='option-btn' onclick='mensajeBienvenida()'>MenÃº principal</button>");
    } else if(op==='contacto'){
        printUser("Quiero hablar con humano");
        printBot("Puedes escribirnos por WhatsApp: <b>+52-1234-567-890</b> o correo soporte@tienda.com ðŸ’¬<br><button class='option-btn' onclick='mensajeBienvenida()'>MenÃº principal</button>");
    } else if(op==='queja'){
        printUser("Tengo una queja");
        printBot("Por favor, escribe tu queja. Se mandarÃ¡ a soporte especializado.<br><button class='option-btn' onclick='mensajeBienvenida()'>MenÃº principal</button>");
        estado = "queja";
    } else if(op==='ayuda'){
        printUser("Â¿CÃ³mo comprar?");
        printBot("Elige producto, agrÃ©galo al carrito, elige pago y envÃ­o. Si necesitas ayuda, dime aquÃ­.<br><button class='option-btn' onclick='mensajeBienvenida()'>MenÃº principal</button>");
    }
}

function categoryProducts(cat){
    estado = "detalle";
    printUser("Busco "+cat);
    let fil = productos.filter(p=>p.categoria===cat);
    if(fil.length){
        fil.forEach(p=>{
            printBot(`<div class="producto-tarjeta">
                    <img src="${p.img}" alt="${p.nombre}">
                    <div><b>${p.nombre}</b><br>
                    Precio: ${p.precio}<br>
                    <small>${p.categoria}</small></div></div>
                    <button class="option-btn" onclick="productDetails('${p.nombre}')">Agregar al carrito</button>`);
        });
    } else printBot("No hay productos disponibles. Â¿Buscas otra cosa?");
    printBot(`<button class="option-btn" onclick="mensajeBienvenida()">MenÃº principal</button>`);
}

function productDetails(nombre){
    let p = productos.find(x=>x.nombre==nombre);
    if(p){
        printBot(`<b>${p.nombre}</b><br>
            Precio: <span style='color:#fc6c85;font-weight:bold;'>${p.precio}</span><br>
            CategorÃ­a: ${p.categoria}<br>
            Producto disponible.<br>
            <button class="option-btn" onclick="addToCart('${p.nombre}')">Agregar al carrito</button> 
            <button class="option-btn" onclick="mensajeBienvenida()">MenÃº principal</button>`);
    }
}

function addToCart(nombre){
    carrito.push(nombre);
    printBot(`Â¡${nombre} agregado! Tu carrito: <b>${carrito.join(", ")}</b><br>
    <button class="option-btn" onclick="finishCart()">Finalizar compra</button>
    <button class="option-btn" onclick="mensajeBienvenida()">Seguir explorando</button>`);
}

function finishCart(){
    printBot("âœ… Compra finalizada. Pronto llegarÃ¡ correo de confirmaciÃ³n.<br>"+
        "<button class='option-btn' onclick='mensajeBienvenida()'>Nuevo pedido</button>");
    carrito=[];
    estado = "inicio";
}

function botReply(msgRaw){
    let msg = msgRaw.toLowerCase();
    if(estado=="queja"){
        localStorage.setItem("queja_"+Date.now(),msgRaw);
        printBot("Gracias por tu queja. Â¿Quieres regresar al menÃº?");
        printBot(`<button class="option-btn" onclick="mensajeBienvenida()">SÃ­, volver</button>`);
        estado = "inicio";
        return;
    }
    if(msg.includes("precio") && msg.includes("jeans")){
        printBot("Jeans mujer: $550, jeans hombre: $590.<br>Â¿Agregar al carrito?");
        printBot(`<button class="option-btn" onclick="categoryProducts('Ropa Mujer')">Jeans Mujer</button>
                  <button class="option-btn" onclick="categoryProducts('Ropa Hombre')">Jeans Hombre</button>
                  <button class="option-btn" onclick="mensajeBienvenida()">MenÃº principal</button>`);
        return;
    }
    if(msg.includes("adios") || msg.includes("salir") || msg.includes("gracias")) {
        printBot("Â¡Gracias por tu visita! ðŸ‘‹ Puedes regresar con el botÃ³n MenÃº principal.");
        printBot(`<button class="option-btn" onclick="mensajeBienvenida()">MenÃº principal</button>`);
        return;
    }
    printBot("No entendÃ­ bien tu pregunta. Â¿Elige una opciÃ³n, revisa el menÃº o usa palabras como producto, pago, envÃ­o, ayuda o queja?");
    printBot(`<button class="option-btn" onclick="mensajeBienvenida()">MenÃº principal</button>`);
}

// BotÃ³n finalizar chat
function finalizarChat(){
    messages.innerHTML = '';
    printBot("âœ… ConversaciÃ³n finalizada. Â¿Quieres empezar otra vez? <button class='option-btn' onclick='mensajeBienvenida()'>Nuevo chat</button>");
    carrito = [];
    estado = "inicio";
}
s